/*!
 * Extension for Ext JS core library 
 * by Farshad Mohajeri for uniGUI Library    
 * Copyright(c) 2009-2014 FMSoft Inc.
 * info@fmsoft.net
 * http://www.unigui.com
!*/
var logEnabled=true;var sendQEnabled=true;var uniSyncObj={concurrentRequests:2,requestId:0,inCallback:0,activeRequests:0,recvQ:[],sendQ:[],lastId:-1};function _log(a){if(logEnabled&&typeof console!="undefined"){console.log(a)}}function callTryFinally(b,a){return function(){var d=true;if(arguments){var c=Array.prototype.slice.call(arguments);c.splice(0,0,null);c.splice(0,0,true);var e=a.apply(this,c);if(e===false){return(false)}if(e&&e.res===false){return(false)}try{if(e.callOrg!==false){d=b.apply(this,arguments)}}finally{c[0]=false;c[1]=d;if(a.apply(this,c)===false){return(false)}}}return(d)}}Ext.override(Ext.data.Connection,{statics:{},initParams:function(){var a=uniSyncObj;if(a.paramsInited){return}a.paramsInited=true;switch(true){case Ext.isIE8:case Ext.isIE9:a.concurrentRequests=window.maxConnectionsPerServer;break;case Ext.isIE:a.concurrentRequests=2;break;case Ext.isSafari:case Ext.isChrome:case Ext.isGecko:case Ext.isGecko3:case Ext.isGecko4:case Ext.isGecko5:case Ext.isGecko10:a.concurrentRequests=4;break}},prepareOptions:function(c){var g=false;this.initParams();c.uid=undefined;if(c.isUpload){return}var e=Ext.isObject(c.params);var f=(typeof c.params=="string");if(e){if(c.params._S_ID){g=true}else{if(c.url){if(c.url.indexOf("&_S_ID=")>=0){g=true}}}}else{if(f){var b=c.params;if(b.indexOf("&_S_ID=")>=0||b.indexOf("=_S_ID=")>=0){g=true}}}var d=uniSyncObj.requestId;var a=uniSyncObj.inCallback;if(g){uniSyncObj.requestId++}c.fromQ=false;c.uid=d;if(g){if(f){c.params+="&_seq_="+d.toString(16);if(a>0){c.params+="&_a_=1"}}else{if(e){c.params._seq_=d.toString(16);if(a>0){c.params._a_=1}}}}},processSendQueue:function(){var a=uniSyncObj.sendQ[0];if(a&&uniSyncObj.activeRequests<uniSyncObj.concurrentRequests){a=uniSyncObj.sendQ.shift();uniSyncObj.activeRequests++;a.fromQ=true;if(a.obj){a.obj.sendBusy=true}a.reqBusy=true;try{return(this.request(a))}finally{a.reqBusy=false}}},request:callTryFinally(Ext.data.Connection.prototype.request,function(a,d,c){if(a){if(c.fromQ){return(true)}this.prepareOptions(c);if(c.uid==undefined){return(true)}if(c.obj){try{_hreq_(c.obj,c.url,c.params);_shm_(c.obj)}catch(f){alert("request : "+f.message)}}if(sendQEnabled){uniSyncObj.sendQ.push(c);this.processSendQueue();return({res:true,callOrg:false})}}else{if(c.reqBusy!==true&&c.obj&&c.e&&c.obj.retfalse&&c.obj.retfalse[c.e]){return(false)}}return(true)}),onComplete:callTryFinally(Ext.data.Connection.prototype.onComplete,function(a,d,g){var f=this,c=g.options,i=c.uid;if(a){if(c.uid==undefined){return(true)}if(g.buffered){return(true)}if(i-uniSyncObj.lastId<=1){return(true)}else{g.buffered=true;uniSyncObj.recvQ.push({request:g});return(false)}}else{if(c&&c.obj){try{if(d&&typeof d.responseText=="string"){_hcbk_(c.obj,d.responseText)}}finally{try{_hde_(c.obj)}catch(h){alert("onComplete : "+h.message)}if(c.obj){c.obj.sendBusy=false}}}}return(true)}),processQueues:function(){try{this.processSendQueue()}finally{this.processRecvQueue()}},cleanup:callTryFinally(Ext.data.Connection.prototype.cleanup,function(a,d,e){if(e.buffered===true){return(false)}var c=e.options;if(a){if(c.uid==undefined){return(true)}if(c.fromQ){c.fromQ=false;if(uniSyncObj.activeRequests){uniSyncObj.activeRequests--}}var f=c.uid;if(f>=0&&uniSyncObj.lastId<f){uniSyncObj.lastId=f}}else{this.processQueues()}return(true)}),processRecvQueue:function(){var e=null,b=0;if(uniSyncObj.recvQ.length>0){for(var c=0,a=uniSyncObj.recvQ.length;c<a;c++){var d=uniSyncObj.recvQ[c].request;b=d.options.uid;if(b-uniSyncObj.lastId<=1){e=uniSyncObj.recvQ[c].request;uniSyncObj.recvQ.splice(c,1);break}}if(e){try{this.onComplete(e)}finally{e.buffered=false;this.cleanup(e)}}}}});Ext.override(Ext,{callback:callTryFinally(Ext.callback,function(a){if(a){uniSyncObj.inCallback++}else{uniSyncObj.inCallback--}return(true)})});