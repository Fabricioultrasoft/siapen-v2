<?xml version="1.0" encoding="utf-8"?>
<TfrxReport Version="4.3.6" DotMatrixReport="False" IniFile="\Software\Fast Reports" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="Default" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="39864,3926124769" ReportOptions.Description.Text="" ReportOptions.LastChange="41134,7099394792" ScriptLanguage="PascalScript" ScriptText.Text="Var Lista : Array[1..1000,1..3] of String;&#13;&#10;ListaAgrupada : Array[1..500,1..2] of String;                                                                                               &#13;&#10;linha : integer = 1;                                   &#13;&#10;contador, QTDTotal : integer = 0;&#13;&#10;  &#13;&#10;procedure Page1OnBeforePrint(Sender: TfrxComponent);&#13;&#10;var&#13;&#10;PosMarcador : integer;&#13;&#10;i,j,countLista,numLista : integer;&#13;&#10;TextoRestante : String;                                                                                      &#13;&#10;begin&#13;&#10;   Database.Params.LoadFromFile('..\config\dbxconnections.ini');        &#13;&#10;   SqlEntradaUP.Open;&#13;&#10;   i := 0;&#13;&#10;   countLista := 1;                                     &#13;&#10;   numLista := 1;&#13;&#10;     &#13;&#10;   //quebra a linha em 3 partes atraves do delimitador ','&#13;&#10;   //Ex. de Linha: Entrada na Unidade Penal: PDF 1 - PENITENCIÁRIA DO DF I, Procedente: CPP - CENTRO DE PROGRESSÃO PENITENCIÁRIA, Conforme Oficio 0000.                                          &#13;&#10;   while not SqlEntradaUP.EOF do&#13;&#10;   begin&#13;&#10;       contador := contador + 1;                                                                     &#13;&#10;       i := i + 1;                               &#13;&#10;       j := 1;                             &#13;&#10;       PosMarcador := Pos(',',SqlEntradaUP.FieldByName('DESCRICAO').AsString);&#13;&#10;       TextoRestante := SqlEntradaUP.FieldByName('DESCRICAO').AsString;                                                      &#13;&#10;                                              &#13;&#10;       while PosMarcador &#60;&#62; 0 do  &#13;&#10;       begin&#13;&#10;            Lista[i,j] := Copy(TextoRestante,1 , PosMarcador - 1);&#13;&#10;            TextoRestante := Copy(TextoRestante, PosMarcador + 2, Length(TextoRestante) - PosMarcador);&#13;&#10;            PosMarcador := Pos(',',TextoRestante);                                          &#13;&#10;            j := j + 1;                                                                                                             &#13;&#10;            &#13;&#10;            if PosMarcador = 0 then&#13;&#10;            begin                        &#13;&#10;               Lista[i,j] := TextoRestante;                                               &#13;&#10;            end;                              &#13;&#10;       end;&#13;&#10;         &#13;&#10;       SqlEntradaUP.Next;                                 &#13;&#10;   end;&#13;&#10;     &#13;&#10;   // looping para limpar o nome, retira o texto Saida da Unidade, Procedência e Conforme.                                                                                                                                                                                                                               &#13;&#10;   for i := 1 to contador do&#13;&#10;   begin&#13;&#10;                                                                                        &#13;&#10;       for j := 1 to 3 do&#13;&#10;       begin&#13;&#10;            if Pos(':', Lista[i,j]) &#60;&#62; 0 then&#13;&#10;            begin                            &#13;&#10;                 Lista[i,j] := Copy(Lista[i,j], Pos(':', Lista[i,j]) + 2, Length(Lista[i,j]) - Pos(':', Lista[i,j]));                                             &#13;&#10;                 j := j + 1;&#13;&#10;            end&#13;&#10;            else if Pos(' ', Lista[i,j]) then&#13;&#10;            begin&#13;&#10;                 Lista[i,j] := Copy(Lista[i,j], Pos(' ', Lista[i,j]) + 1, Length(Lista[i,j]) - Pos(' ', Lista[i,j]));                                             &#13;&#10;                 j := j + 1;  &#13;&#10;            end;                      &#13;&#10;       end;                                     &#13;&#10;       i := i + 1;                                   &#13;&#10;   end;&#13;&#10;   &#13;&#10;   //looping para agrupar e contar                                                                  &#13;&#10;   for i := 1 to contador do&#13;&#10;   begin&#13;&#10;            //Posição [ ,2] fixada, pois quero saber a Procedência e ela é o segundo campo da quebra.                                                                                                                                                                                                                                                                       &#13;&#10;            if Lista[i,2] &#60;&#62; Lista[i + 1,2] then&#13;&#10;            begin                           &#13;&#10;                 ListaAgrupada[numLista,1] := Lista[i,2];        &#13;&#10;                 ListaAgrupada[numLista,2] := intToStr(countLista);&#13;&#10;                 countLista := 1;&#13;&#10;                 numLista := numLista + 1;                                               &#13;&#10;                 i := i + 1;                                          &#13;&#10;            end  &#13;&#10;            else if Lista[i,2] = Lista[i + 1,2] then&#13;&#10;            begin&#13;&#10;                 countLista := countLista + 1;                                             &#13;&#10;                 i := i + 1;                                                                 &#13;&#10;            end;                      &#13;&#10;                                      &#13;&#10;   end;     &#13;&#10;&#13;&#10;   //O masterData vai receber a quantidade de registros (linhas) que foram agrupadas.                                                                                                                                                                                                       &#13;&#10;   MasterData1.RowCount :=  numLista - 1;&#13;&#10;     &#13;&#10;end;&#13;&#10;&#13;&#10;&#13;&#10;procedure frxReport1OnStartReport(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  {     IF ((&#60;GLOBAL_JURIDICA&#62; &#60;&#62; 'R') and (&#60;GLOBAL_DISCIPLINA&#62; &#60;&#62; 'R')) THEN&#13;&#10;       begin&#13;&#10;               SHOWMESSAGE('Não há Permissão Para Visualizar Relatório!');&#13;&#10;               page1.free;&#13;&#10;       end;    }                  &#13;&#10;end;&#13;&#10;&#13;&#10;procedure DialogPage1OnShow(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;       DateEdit1.date := StrToDate('01/' + intToStr(MonthOf(now()) - 1) + '/' + intToStr(YearOf(now())));&#13;&#10;       DateEdit2.date := StrToDate(intToStr(daysInMonth(YearOf(now()), MonthOf(now()) - 1)) + '/' + intToStr(MonthOf(now()) - 1) + '/' + intToStr(YearOf(now())));                &#13;&#10;end;&#13;&#10;&#13;&#10;&#13;&#10;procedure MasterData1OnBeforePrint(Sender: TfrxComponent);                                         &#13;&#10;begin  &#13;&#10;    //Atribuindo valores aos memos para ser escrito na tela e fazendo o count do total de entradas.                                                                                                                                                                                                                                 &#13;&#10;    MemoData.memo.text := '[ListaAgrupada['+intToStr(linha)+',1]]';&#13;&#10;    MemoQTD.memo.text := '[ListaAgrupada['+intToStr(linha)+',2]]';&#13;&#10;    QTDTotal := QTDTotal + strToInt(ListaAgrupada[linha,2]);                                                              &#13;&#10;    linha := linha + 1;     &#13;&#10;end;&#13;&#10;&#13;&#10;procedure ColumnFooter1OnBeforePrint(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  //Escreve o quantitativo total de entradas                                                                                                     &#13;&#10;  MemoTotal.memo.text := intToStr(QTDTotal);                                                                  &#13;&#10;end;&#13;&#10;&#13;&#10;begin&#13;&#10;&#13;&#10;end." OnStartReport="frxReport1OnStartReport" PropData="044C65667403F80003546F70024808446174617365747301010C3400000020446174615365743D22667278444244617461736574312220446174615365744E616D653D22667278444244617461736574312200010C3200000020446174615365743D2253716C456E747261646155502220446174615365744E616D653D2253716C456E747261646155502200010C2400000020446174615365743D2253716C75702220446174615365744E616D653D2253716C7570220000095661726961626C657301010C0D000000204E616D653D2220534941502200010C13000000204E616D653D22444154415F4147454E44412200010C17000000204E616D653D22474C4F42414C5F4A555249444943412200010C19000000204E616D653D22474C4F42414C5F4449534349504C494E412200010C19000000204E616D653D2249445F5550222056616C75653D223130362200010C34000000204E616D653D22474C4F42414C5F4F5247414F222056616C75653D22274D494E495354C952494F204441204A55535449C741272200010C49000000204E616D653D22474C4F42414C5F444550415254414D454E544F222056616C75653D2227444550415254414D454E544F2050454E4954454E4349C152494F204E4143494F4E414C272200010C4B000000204E616D653D22474C4F42414C5F44495245544F524941222056616C75653D222744495245544F52494120444F2053495354454D412050454E4954454E4349C152494F20444F20444627220000055374796C650100">
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000">
    <TfrxDBXDatabase Name="database" ConnectionName="IBLocal" DriverName="DevartInterBase" GetDriverFunc="getSQLDriverInterBase" LibraryName="dbexpida.dll" LoginPrompt="False" Params.Text="[SIAP]&#13;&#10;DriverName=UIB FireBird15&#13;&#10;BlobSize=-1&#13;&#10;CommitRetain=False&#13;&#10;ErrorResourceFile=&#13;&#10;LocaleCode=0000&#13;&#10;RoleName=&#13;&#10;ServerCharSet=&#13;&#10;SQLDialect=3&#13;&#10;Interbase TransIsolation=ReadCommited&#13;&#10;WaitOnLocks=True&#13;&#10;#Database=localhost:D:\DEPEN\PFCG\FEDERAL.FDB&#13;&#10;Database=localhost:C:\$ Fontes\--SIAP\FEDERAL.FDB&#13;&#10;User_Name=SYSDBA&#13;&#10;Password=masterkey&#13;&#10;LOCAL=DEPEN&#13;&#10;NOME=SISTEMA PENITENCIÁRIO NACIONAL&#13;&#10;ORGAO=MINISTÉRIO DA JUSTIÇA&#13;&#10;DEPARTAMENTO=DEPARTAMENTO PENITENCIÁRIO NACIONAL&#13;&#10;DIRETORIA=DIRETORIA DO SISTEMA PENITENCIÁRIO FEDERAL&#13;&#10;SKIN=skin0264.skn" VendorLib="fbclient.DLL" PropData="05704C656674030C010470546F700248"/>
    <TfrxDBXQuery Name="SqlEntradaUP" UserName="SqlEntradaUP" CloseDataSource="True" FieldAliases.Text="" SQL.Text="SELECT hi.descricao&#13;&#10;&#13;&#10;FROM historico_interno hi&#13;&#10;INNER JOIN unidade_penal up ON (up.id_up = hi.idup)&#13;&#10;&#13;&#10;WHERE hi.status = 'E'&#13;&#10;AND hi.idup = :id_up          &#13;&#10;AND hi.data_hora BETWEEN :dataInicial and :dataFinal&#13;&#10;  &#13;&#10;ORDER BY hi.descricao                                                                                               " Database="database" PropData="05704C65667403AC000470546F700390000A506172616D657465727301010C3F000000204E616D653D2269645F7570222044617461547970653D226674496E7465676572222045787072657373696F6E3D22262336303B49445F5550262336323B2200010C41000000204E616D653D2264617461496E696369616C222044617461547970653D22667444617465222045787072657373696F6E3D224461746545646974312E446174652200010C3F000000204E616D653D226461746146696E616C222044617461547970653D22667444617465222045787072657373696F6E3D224461746545646974322E44617465220000"/>
    <TfrxDBXQuery Name="Sqlup" UserName="Sqlup" CloseDataSource="True" FieldAliases.Text="" SQL.Text="SELECT u.nome_up, u.endereco, u.bairro, u.numero, u.complemento, u.cep,&#13;&#10;c.cidade||' - '||c.uf as cidade, u.fone, u.fax, u.email                     &#13;&#10;from unidade_penal u&#13;&#10;inner join cidade c on(c.id_cidade=u.id_cidade)                                                       &#13;&#10;WHERE ID_UP = :ID_UP  " Database="database" PropData="05704C65667403AC000470546F7002480A506172616D657465727301010C3F000000204E616D653D2249445F5550222044617461547970653D226674496E7465676572222045787072657373696F6E3D22262336303B49445F5550262336323B220000"/>
  </TfrxDataPage>
  <TfrxReportPage Name="Page1" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Courier" Font.Style="0" PaperWidth="210" PaperHeight="297" PaperSize="9" LeftMargin="10" RightMargin="10" TopMargin="5" BottomMargin="10" Columns="1" ColumnWidth="211,9" ColumnPositions.Text="0" HGuides.Text="" VGuides.Text="" OnBeforePrint="Page1OnBeforePrint">
    <TfrxReportTitle Name="ReportTitle1" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Courier" Font.Style="0" Height="120,94496" Left="0" ParentFont="False" Top="16" Width="718,1107">
      <TfrxMemoView Name="Memo1" Left="0" Top="2,77953488" Width="718,1107" Height="64,25201" DisplayFormat.DecimalSeparator="," Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Times New Roman" Font.Style="1" HAlign="haCenter" ParentFont="False" Text="[GLOBAL_ORGAO]&#13;&#10;[GLOBAL_DEPARTAMENTO]&#13;&#10;[GLOBAL_DIRETORIA]&#13;&#10;[Sqlup.&#34;NOME_UP&#34;]"/>
      <TfrxPictureView Name="Picture1" Left="3,77952024" Top="3,77953" Width="109,60629921" Height="105,82677165" FileLink="../logo/esquerda.jpg"/>
      <TfrxMemoView Name="Memo8" Left="0" Top="69,47248488" Width="718,1107" Height="37,7953" DisplayFormat.DecimalSeparator="," Font.Charset="1" Font.Color="0" Font.Height="-9" Font.Name="Times New Roman" Font.Style="0" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="[Sqlup.&#34;ENDERECO&#34;]  [Sqlup.&#34;NUMERO&#34;]  [Sqlup.&#34;BAIRRO&#34;]  [Sqlup.&#34;COMPLEMENTO&#34;]&#13;&#10;CEP: [Formatmasktext('00.000-000;0',&#60;Sqlup.&#34;CEP&#34;&#62;)] - [Sqlup.&#34;CIDADE&#34;]&#13;&#10;Fone: [Sqlup.&#34;FONE&#34;] - Fax: [Sqlup.&#34;FAX&#34;] -  [Sqlup.&#34;EMAIL&#34;]"/>
      <TfrxPictureView Name="Picture2" Left="604,7248" Top="3,77953488" Width="109,60629921" Height="105,82677165" FileLink="../logo/direita.jpg"/>
    </TfrxReportTitle>
    <TfrxColumnHeader Name="ColumnHeader1" Height="90,70870535" Left="0" Top="156" Width="718,1107">
      <TfrxMemoView Name="Memo2" Left="0" Top="0" Width="718,1107" Height="22,67718" DisplayFormat.DecimalSeparator="," Font.Charset="1" Font.Color="0" Font.Height="-16" Font.Name="Arial" Font.Style="1" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Fechamento do Livro de Entrada"/>
      <TfrxMemoView Name="Memo3" Left="0" Top="22,67718" Width="718,1107" Height="22,67718" DisplayFormat.DecimalSeparator="," Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="PerÃ­odo: [datetostr(DATEEDIT1.date)] - [datetostr(DATEEDIT2.date)]"/>
      <TfrxMemoView Name="Memo9" Left="623,62245" Top="68,03154" Width="94,48825" Height="22,67716535" DisplayFormat.DecimalSeparator="," Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="QUANTIDADE"/>
      <TfrxMemoView Name="Memo10" Left="0" Top="68,03154" Width="623,62245" Height="22,67716535" DisplayFormat.DecimalSeparator="," Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="PROCEDENTE DO(A)"/>
    </TfrxColumnHeader>
    <TfrxPageFooter Name="PageFooter1" Height="26,45671" Left="0" Top="356" Width="718,1107">
      <TfrxMemoView Name="Memo19" Left="366,61441" Top="3,77953" Width="351,49629" Height="18,89765" DisplayFormat.DecimalSeparator="," Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" HAlign="haRight" ParentFont="False" Text="Projeto SIAPEN, Impresso em [Date] - [time], Pag. [Page#]/[TotalPages#]"/>
    </TfrxPageFooter>
    <TfrxMasterData Name="MasterData1" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Courier" Font.Style="0" Height="22,67716535" Left="0" ParentFont="False" Top="268" Width="718,1107" OnBeforePrint="MasterData1OnBeforePrint" ColumnWidth="0" ColumnGap="0" RowCount="1" Stretched="True">
      <TfrxMemoView Name="MemoData" Left="0" Top="0" Width="623,62245" Height="22,67716535" StretchMode="smActualHeight" DataSet="SqlEntradaUP" DataSetName="SqlEntradaUP" DisplayFormat.DecimalSeparator="," Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" VAlign="vaCenter" Text=""/>
      <TfrxMemoView Name="MemoQTD" Left="623,62245" Top="0" Width="94,48825" Height="22,67716535" StretchMode="smActualHeight" DataSet="SqlEntradaUP" DataSetName="SqlEntradaUP" DisplayFormat.DecimalSeparator="," Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text=""/>
    </TfrxMasterData>
    <TfrxColumnFooter Name="ColumnFooter1" Height="22,67718" Left="0" Top="312" Width="718,1107" OnBeforePrint="ColumnFooter1OnBeforePrint">
      <TfrxMemoView Name="Memo4" Left="0" Top="0" Width="623,62245" Height="22,67716535" DisplayFormat.DecimalSeparator="," Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" ParentFont="False" VAlign="vaCenter" Text="TOTAL DE ENTRADAS"/>
      <TfrxMemoView Name="MemoTotal" Left="623,62245" Top="0" Width="94,48825" Height="22,67716535" DisplayFormat.DecimalSeparator="," Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text=""/>
    </TfrxColumnFooter>
  </TfrxReportPage>
  <TfrxDialogPage Name="DialogPage1" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Tahoma" Font.Style="0" Height="127" Left="265" Top="150" Width="358" OnShow="DialogPage1OnShow">
    <TfrxDateEditControl Name="DateEdit1" Left="4" Top="24" Width="145" Height="21" Color="-16777211" Date="40934,6628965046" Time="40934,6628965046"/>
    <TfrxDateEditControl Name="DateEdit2" Left="188" Top="24" Width="145" Height="21" Color="-16777211" Date="40934,6630239005" Time="40934,6630239005"/>
    <TfrxButtonControl Name="Button1" Left="256" Top="56" Width="75" Height="25" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Tahoma" Font.Style="0" ParentFont="False" Caption="OK" Default="True" ModalResult="1"/>
    <TfrxLabelControl Name="Label1" Left="4" Top="4" Width="72" Height="16" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Tahoma" Font.Style="1" ParentFont="False" Caption="Data Inicial" Color="13948117"/>
    <TfrxLabelControl Name="Label2" Left="188" Top="4" Width="63" Height="16" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Tahoma" Font.Style="1" ParentFont="False" Caption="Data Final" Color="13948117"/>
  </TfrxDialogPage>
</TfrxReport>
